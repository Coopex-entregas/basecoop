{% extends "base.html" %}

{% block title %}Painel do Cooperado{% endblock %}

{% block content %}
<style>
    /* Cards de status menores */
    .status-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .status-card {
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        font-weight: 600;
    }

    .status-pendentes {
        background: #fed7d7;
        color: #c53030;
    }

    .status-em-rota {
        background: #feebc8;
        color: #c05621;
    }

    .status-entregues {
        background: #c6f6d5;
        color: #22543d;
    }

    /* Tabela responsiva */
    .table-container {
        overflow-x: auto;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 1rem;
    }

    th, td {
        padding: 10px;
        border-bottom: 1px solid #e2e8f0;
        text-align: left;
        white-space: nowrap;
    }

    /* Coluna descriÃ§Ã£o maior com quebra */
    th:nth-child(2),
    td:nth-child(2) {
        min-width: 220px;
        max-width: 350px;
        white-space: normal;
        word-wrap: break-word;
    }

    /* BotÃ£o */
    .btn {
        background-color: #3182ce;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        text-decoration: none;
        white-space: nowrap;
    }

    /* Status entrega cores originais */
    .status-pendente {
        color: #c53030;
        font-weight: bold;
    }

    .status-em-rota {
        color: #c05621;
        font-weight: bold;
    }

    .status-entregue {
        color: #22543d;
        font-weight: bold;
    }

    /* Status pagamento */
    .pagamento-pago {
        color: #22543d; /* verde escuro */
        font-weight: 600;
    }

    .pagamento-pendente {
        color: #c53030; /* vermelho */
        font-weight: 600;
    }

    /* Responsividade */
    @media (max-width: 768px) {
        table {
            font-size: 0.9rem;
        }

        th, td {
            padding: 8px;
        }

        .btn {
            font-size: 12px;
            padding: 5px 10px;
        }
    }
</style>

<div class="header">
    <h1>Dashboard do Cooperado</h1>
    <p style="color: #718096; margin-bottom: 20px;">Bem-vindo, {{ session['usuario_nome'] }}!</p>

    <div class="nav-links">
        <a href="{{ url_for('logout') }}" class="logout" style="color:#e53e3e; font-weight:bold; text-decoration:none;">
            <span style="margin-right: 8px;">ðŸšª</span>
            Sair
        </a>
    </div>
</div>

<div class="content">
    <h2 class="section-title">
        <span style="margin-right: 10px;">ðŸ“¦</span>
        Minhas Entregas
    </h2>

    {% if entregas %}
        <!-- Resumo de status -->
        <div class="status-cards">
            {% set pendentes = entregas|selectattr("status_entrega", "equalto", "pendente")|list|length %}
            {% set em_rota = entregas|selectattr("status_entrega", "equalto", "em rota")|list|length %}
            {% set entregues = entregas|selectattr("status_entrega", "equalto", "entregue")|list|length %}

            <div class="status-card status-pendentes">
                <div style="font-size: 2rem; font-weight: bold;">{{ pendentes }}</div>
                <div>Pendentes</div>
            </div>

            <div class="status-card status-em-rota">
                <div style="font-size: 2rem; font-weight: bold;">{{ em_rota }}</div>
                <div>Em Rota</div>
            </div>

            <div class="status-card status-entregues">
                <div style="font-size: 2rem; font-weight: bold;">{{ entregues }}</div>
                <div>Entregues</div>
            </div>
        </div>

        <!-- Tabela de entregas -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Valor</th>
                        <th>Data/Hora</th>
                        <th>Status Pagamento</th>
                        <th>Status Entrega</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entrega in entregas %}
                    <tr>
                        <td>#{{ entrega.id }}</td>
                        <td>{{ entrega.descricao }}</td>
                        <td>R$ {{ "%.2f"|format(entrega.valor or 0) }}</td>
                        <td>{{ entrega.hora_pedido.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>
                            {% if entrega.status_pagamento == 'pago' %}
                                <span class="pagamento-pago">Pago</span>
                            {% else %}
                                <span class="pagamento-pendente">Pendente</span>
                            {% endif %}
                        </td>
                        <td>
                            <span class="status-{{ entrega.status_entrega|replace(' ', '-') }}">
                                {% if entrega.status_entrega == 'pendente' %}
                                    Pendente
                                {% elif entrega.status_entrega == 'em rota' %}
                                    Em Rota
                                {% else %}
                                    Entregue
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('editar_entrega', entrega_id=entrega.id) }}" class="btn">
                                Atualizar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 60px; color: #718096;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ðŸ“¦</div>
            <h3 style="margin-bottom: 10px;">Nenhuma entrega atribuÃ­da</h3>
            <p>Aguarde novas entregas serem atribuÃ­das a vocÃª pelo administrador.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
