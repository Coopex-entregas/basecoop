{% extends "base.html" %}

{% block title %}Painel do Cooperado - Coopex{% endblock %}

{% block content %}
<div class="header">
    <h1>Bem-vindo, {{ session['usuario_nome'] }}</h1>
    <a href="{{ url_for('logout') }}" class="logout">
        <span style="margin-right: 8px;">ðŸšª</span> Sair
    </a>
</div>

<!-- Filtro de data -->
<form method="get" action="{{ url_for('dashboard') }}" style="margin: 20px 0;">
  <label for="data_filtro">Filtrar por data:</label>
  <input type="date" id="data_filtro" name="data_filtro" value="{{ data_filtro or '' }}">
  <button type="submit">Filtrar</button>
</form>

<div class="content">

    <h2 class="section-title">Minhas Entregas</h2>

    {% if entregas %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Cliente</th>
                <th>Valor</th>
                <th>Hora do Pedido</th>
                <th>Hora AtribuÃ­da</th>
                <th>Status Pagamento</th>
                <th>Status Entrega</th>
                <th>AÃ§Ãµes</th>
            </tr>
        </thead>
        <tbody>
            {% for e in entregas %}
            <tr>
                <td><strong>#{{ e.id }}</strong></td>
                <td>{{ e.descricao }}</td>
                <td><strong>R$ {{ "%.2f"|format(e.valor or 0) }}</strong></td>
                <td>{{ e.hora_pedido|utc_to_brt }}</td>  {# **Aqui estÃ¡ o filtro que corrige a hora** #}
                <td>
                    {% if e.hora_atribuida %}
                        {{ e.hora_atribuida|utc_to_brt }}
                    {% else %}
                        <span style="color: #718096;">-</span>
                    {% endif %}
                </td>
                <td>
                    <span class="status-{{ e.status_pagamento }}">
                        {% if e.status_pagamento == 'pendente' %}
                            Pendente
                        {% else %}
                            Pago
                        {% endif %}
                    </span>
                </td>
                <td>
                    <span class="status-{{ e.status_entrega|replace(' ', '-') }}">
                        {% if e.status_entrega == 'pendente' %}
                            Pendente
                        {% elif e.status_entrega == 'em rota' %}
                            Em Rota
                        {% else %}
                            Entregue
                        {% endif %}
                    </span>
                </td>
                <td>
                    <a href="{{ url_for('editar_entrega', entrega_id=e.id) }}" class="btn" style="padding: 6px 12px; font-size: 14px;">
                        Editar
                    </a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Nenhuma entrega encontrada para o perÃ­odo selecionado.</p>
    {% endif %}
</div>
{% endblock %}
