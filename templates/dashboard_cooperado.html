{% extends "base.html" %}

{% block title %}Painel do Cooperado{% endblock %}

{% block content %}
<div class="header">
    <h1>Dashboard do Cooperado</h1>
    <p style="color: #718096; margin-bottom: 20px;">Bem-vindo, {{ session['usuario_nome'] }}!</p>

    <div class="nav-links">
        <a href="{{ url_for('logout') }}" class="logout">
            <span style="margin-right: 8px;">ğŸšª</span>
            Sair
        </a>
    </div>
</div>

<div class="content">
    <h2 class="section-title">
        <span style="margin-right: 10px;">ğŸ“¦</span>
        Minhas Entregas
    </h2>

    {% if entregas %}
        <!-- Resumo de status -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            {% set pendentes = entregas|selectattr("status_entrega", "equalto", "pendente")|list|length %}
            {% set em_rota = entregas|selectattr("status_entrega", "equalto", "em rota")|list|length %}
            {% set entregues = entregas|selectattr("status_entrega", "equalto", "entregue")|list|length %}

            <div style="background: #fed7d7; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #c53030;">{{ pendentes }}</div>
                <div style="color: #c53030; font-weight: 600;">Pendentes</div>
            </div>

            <div style="background: #feebc8; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #c05621;">{{ em_rota }}</div>
                <div style="color: #c05621; font-weight: 600;">Em Rota</div>
            </div>

            <div style="background: #c6f6d5; padding: 20px; border-radius: 8px; text-align: center;">
                <div style="font-size: 2rem; font-weight: bold; color: #22543d;">{{ entregues }}</div>
                <div style="color: #22543d; font-weight: 600;">Entregues</div>
            </div>
        </div>

        <!-- Tabela de entregas -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Data/Hora</th>
                        <th>Status Pagamento</th>
                        <th>Status Entrega</th>
                        <th>AÃ§Ãµes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for entrega in entregas %}
                    <tr>
                        <td>#{{ entrega.id }}</td>
                        <td>{{ entrega.descricao }}</td>
                        <td>{{ entrega.hora_pedido.strftime('%d/%m/%Y %H:%M') }}</td>
                        <td>
                            <form method="post" action="{{ url_for('editar_entrega', entrega_id=entrega.id) }}">
                                <select name="status_pagamento" onchange="this.form.submit()">
                                    <option value="pendente" {% if entrega.status_pagamento == 'pendente' %}selected{% endif %}>Pendente</option>
                                    <option value="pago" {% if entrega.status_pagamento == 'pago' %}selected{% endif %}>Pago</option>
                                </select>
                            </form>
                        </td>
                        <td>
                            <span class="status-{{ entrega.status_entrega|replace(' ', '-') }}">
                                {% if entrega.status_entrega == 'pendente' %}
                                    Pendente
                                {% elif entrega.status_entrega == 'em rota' %}
                                    Em Rota
                                {% else %}
                                    Entregue
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            <a href="{{ url_for('editar_entrega', entrega_id=entrega.id) }}" class="btn" style="padding: 6px 12px; font-size: 14px;">
                                Atualizar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div style="text-align: center; padding: 60px; color: #718096;">
            <div style="font-size: 4rem; margin-bottom: 20px;">ğŸ“¦</div>
            <h3 style="margin-bottom: 10px;">Nenhuma entrega atribuÃ­da</h3>
            <p>Aguarde novas entregas serem atribuÃ­das a vocÃª pelo administrador.</p>
        </div>
    {% endif %}
</div>
{% endblock %}
