{% extends "base.html" %}

{% block title %}Editar Entrega{% endblock %}

{% block content %}
<div class="header">
    <h1>Editar Entrega #{{ entrega.id }}</h1>
    <p style="color: #718096;">Preencha os campos abaixo para atualizar a entrega.</p>
</div>

<div class="content">
    <form method="POST">
        {% if user_tipo == 'adm' %}
        <!-- Campos visíveis apenas para ADMIN -->
        <div class="form-group">
            <label for="descricao">Descrição (Cliente)</label>
            <input type="text" id="descricao" name="descricao" value="{{ entrega.descricao }}" required>
        </div>

        <div class="form-group">
            <label for="valor">Valor (R$)</label>
            <input type="number" step="0.01" id="valor" name="valor" value="{{ entrega.valor or 0 }}" required>
        </div>

        <div class="form-group">
            <label for="hora_pedido">Hora do Pedido</label>
            <input type="datetime-local" id="hora_pedido" name="hora_pedido"
                value="{{ entrega.hora_pedido|utc_to_brt|replace('/', '-')|replace(' ', 'T') }}">
        </div>

        <div class="form-group">
            <label for="cooperado_id">Atribuir a Cooperado</label>
            <select name="cooperado_id" id="cooperado_id">
                <option value="">Não atribuído</option>
                {% for c in cooperados %}
                    <option value="{{ c.id }}" {% if entrega.cooperado_id == c.id %}selected{% endif %}>{{ c.nome }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <!-- Campos visíveis para ambos -->
        <div class="form-group">
            <label for="status_pagamento">Status Pagamento</label>
            <select name="status_pagamento" id="status_pagamento" required>
                <option value="pendente" {% if entrega.status_pagamento == 'pendente' %}selected{% endif %}>Pendente</option>
                <option value="pago" {% if entrega.status_pagamento == 'pago' %}selected{% endif %}>Pago</option>
            </select>
        </div>

        <div class="form-group">
            <label for="status_entrega">Status Entrega</label>
            <select name="status_entrega" id="status_entrega" required>
                <option value="pendente" {% if entrega.status_entrega == 'pendente' %}selected{% endif %}>Pendente</option>
                <option value="em rota" {% if entrega.status_entrega == 'em rota' %}selected{% endif %}>Em Rota</option>
                <option value="entregue" {% if entrega.status_entrega == 'entregue' %}selected{% endif %}>Entregue</option>
            </select>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Salvar Alterações</button>
            <a href="{{ url_for('dashboard_admin' if user_tipo == 'adm' else 'dashboard_cooperado') }}" class="btn">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}
