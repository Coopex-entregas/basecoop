{% extends "base.html" %}

{% block title %}Editar Entrega{% endblock %}

{% block content %}
<div class="container">
    <h1>Editar Entrega #{{ entrega.id }}</h1>

    <form method="POST">
        {% if user_tipo == 'adm' %}
            <div class="form-group">
                <label for="descricao">Descrição / Cliente:</label>
                <input type="text" id="descricao" name="descricao" value="{{ entrega.descricao }}" required>
            </div>

            <div class="form-group">
                <label for="valor">Valor:</label>
                <input type="number" step="0.01" id="valor" name="valor" value="{{ entrega.valor }}" required>
            </div>

            <div class="form-group">
                <label for="cooperado_id">Atribuir a um cooperado:</label>
                <select id="cooperado_id" name="cooperado_id">
                    <option value="">-- Não atribuído --</option>
                    {% for c in cooperados %}
                        <option value="{{ c.id }}" {% if entrega.cooperado_id == c.id %}selected{% endif %}>{{ c.nome }}</option>
                    {% endfor %}
                </select>
            </div>
        {% else %}
            <!-- Para cooperado, mostra descrição, valor e cooperado só como leitura -->
            <div class="form-group">
                <label>Descrição / Cliente:</label>
                <p>{{ entrega.descricao }}</p>
            </div>

            <div class="form-group">
                <label>Valor:</label>
                <p>R$ {{ "%.2f"|format(entrega.valor or 0) }}</p>
            </div>

            <div class="form-group">
                <label>Cooperado atribuído:</label>
                <p>{{ entrega.cooperado.nome if entrega.cooperado else "Não atribuído" }}</p>
            </div>
        {% endif %}

        <!-- Status Pagamento editável para admin e cooperado -->
        <div class="form-group">
            <label for="status_pagamento">Status Pagamento:</label>
            <select id="status_pagamento" name="status_pagamento">
                <option value="pendente" {% if entrega.status_pagamento == 'pendente' %}selected{% endif %}>Pendente</option>
                <option value="pago" {% if entrega.status_pagamento == 'pago' %}selected{% endif %}>Pago</option>
            </select>
        </div>

        <!-- Status Entrega editável para ambos -->
        <div class="form-group">
            <label for="status_entrega">Status Entrega:</label>
            <select id="status_entrega" name="status_entrega">
                <option value="pendente" {% if entrega.status_entrega == 'pendente' %}selected{% endif %}>Pendente</option>
                <option value="em rota" {% if entrega.status_entrega == 'em rota' %}selected{% endif %}>Em Rota</option>
                <option value="entregue" {% if entrega.status_entrega == 'entregue' %}selected{% endif %}>Entregue</option>
            </select>
        </div>

        <div class="form-actions" style="margin-top: 20px;">
            <button type="submit" class="btn btn-success">Salvar Alterações</button>
            <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}
